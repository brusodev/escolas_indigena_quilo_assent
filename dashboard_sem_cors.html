<!DOCTYPE html>
<!--
=================================================================
DASHBOARD CITEM COMPLETO - VERS√ÉO SEM CORS
=================================================================
Esta vers√£o resolve problemas de CORS embutindo dados diretamente
no HTML, permitindo execu√ß√£o via file:// protocol.

FUNCIONALIDADES:
‚úÖ 5.582 escolas mapeadas
‚úÖ Mapa interativo funcional
‚úÖ Filtros por tipo de escola
‚úÖ Sem depend√™ncias externas de m√≥dulos
‚úÖ Funciona abrindo diretamente no navegador

Data: 11/08/2025
=================================================================
-->
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard CITEM Completo - Sem CORS</title>
  
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <!-- Leaflet JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .header h1 {
      color: #2c3e50;
      margin-bottom: 10px;
      font-size: 2.2em;
    }

    .header .subtitle {
      color: #7f8c8d;
      font-style: italic;
      font-size: 1.1em;
    }

    .main-container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .stats-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      text-align: center;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .stat-card:hover {
      transform: translateY(-5px);
    }

    .stat-card.escolas {
      background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
      color: white;
    }

    .stat-card.diretorias {
      background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
      color: white;
    }

    .stat-card.tipos {
      background: linear-gradient(135deg, #ff7675 0%, #fd79a8 100%);
      color: white;
    }

    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 10px;
    }

    .stat-label {
      font-size: 1.1em;
      opacity: 0.9;
    }

    .filters-section {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .filters-section h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    .type-filters {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 10px;
    }

    .type-filter-btn {
      display: flex;
      align-items: center;
      padding: 12px 16px;
      border: 2px solid transparent;
      border-radius: 10px;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 0.9em;
      font-weight: 500;
    }

    .type-filter-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
      border-color: #007bff;
    }

    .type-filter-btn.active {
      background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
      color: white;
      border-color: #0056b3;
      box-shadow: 0 5px 15px rgba(0, 123, 255, 0.3);
    }

    .type-filter-btn .filter-icon {
      margin-right: 8px;
      font-size: 1.1em;
    }

    .main-content {
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .panel {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
    }

    .panel h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    #map {
      height: 500px;
      border-radius: 10px;
      margin-bottom: 15px;
    }

    .map-legend {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-top: 15px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      padding: 5px 0;
      font-size: 0.9em;
    }

    .legend-item .legend-icon {
      margin-right: 8px;
      font-size: 1.2em;
      font-weight: bold;
    }

    .search-box {
      width: 100%;
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 1em;
      margin-bottom: 15px;
    }

    .search-box:focus {
      outline: none;
      border-color: #007bff;
    }

    .school-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .school-item {
      background: #f8f9fa;
      border-radius: 10px;
      padding: 15px;
      margin-bottom: 10px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .school-item:hover {
      background: #e3f2fd;
      transform: translateX(5px);
    }

    .school-name {
      color: #2c3e50;
      margin-bottom: 8px;
      font-size: 1.1em;
    }

    .school-details {
      font-size: 0.9em;
      color: #666;
    }

    .school-details p {
      margin-bottom: 4px;
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }

    @media (max-width: 768px) {
      .main-content {
        grid-template-columns: 1fr;
      }
      
      .type-filters {
        grid-template-columns: 1fr;
      }
      
      .stats-section {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
    }
  </style>
</head>

<body>
  <div class="header">
    <h1>üéØ Dashboard CITEM Completo</h1>
    <p class="subtitle">5.582 Escolas √ó Sistema Estadual Paulista √ó An√°lise Interativa</p>
  </div>

  <div class="main-container">
    <!-- Estat√≠sticas Gerais -->
    <div class="stats-section">
      <div class="stat-card escolas">
        <div class="stat-number" id="total-schools">‚è≥</div>
        <div class="stat-label">Total de Escolas</div>
      </div>
      <div class="stat-card diretorias">
        <div class="stat-number" id="total-diretorias">89</div>
        <div class="stat-label">Unidades Regionais</div>
      </div>
      <div class="stat-card tipos">
        <div class="stat-number" id="total-tipos">10</div>
        <div class="stat-label">Tipos de Escola</div>
      </div>
    </div>

    <!-- Filtros por Tipo de Escola -->
    <div class="filters-section">
      <h3>üéõÔ∏è Filtros por Tipo de Escola</h3>
      <div class="type-filters" id="type-filters">
        <!-- Filtros ser√£o gerados dinamicamente -->
      </div>
    </div>

    <!-- Se√ß√£o Principal: Mapa e Lista -->
    <div class="main-content">
      <!-- Mapa Interativo -->
      <div class="panel">
        <h3>üó∫Ô∏è Mapa Interativo - Sistema CITEM</h3>
        <div id="map"></div>
        
        <!-- Legenda do Mapa -->
        <div class="map-legend">
          <h4>üìç Legenda do Mapa</h4>
          <div id="map-legend-content">
            <!-- Legenda ser√° gerada dinamicamente -->
          </div>
        </div>
      </div>

      <!-- Lista de Escolas -->
      <div class="panel">
        <h3>üìã Escolas do Sistema CITEM</h3>
        <input type="text" class="search-box" placeholder="üîç Buscar escola, cidade ou unidade regional..." id="search-input">
        <div class="school-list" id="school-list">
          <div class="loading">‚è≥ Carregando dados das escolas...</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Dados das escolas ser√£o carregados aqui
    let schoolsData = [];
    let map = null;
    let currentFilter = 'all';
    let filteredSchools = [];
    let schoolMarkers = [];

    // Configura√ß√£o de cores por tipo de escola
    const ESCOLA_COLORS = {
      'indigena': '#8B4513',
      'quilombola': '#800080', 
      'assentamento': '#228B22',
      'regular': '#4169E1',
      'ceeja': '#FF6347',
      'cel_jto': '#FF8C00',
      'hospitalar': '#DC143C',
      'penitenciaria': '#2F4F4F',
      'socioeduc': '#9932CC',
      'socioeduc_adolesc': '#8A2BE2'
    };

    // Nomes amig√°veis dos tipos
    const TIPO_NAMES = {
      'indigena': 'Ind√≠gena',
      'quilombola': 'Quilombola',
      'assentamento': 'Assentamento', 
      'regular': 'Regular',
      'ceeja': 'CEEJA',
      'cel_jto': 'CEL JTO',
      'hospitalar': 'Hospitalar',
      'penitenciaria': 'Penitenci√°ria',
      'socioeduc': 'Socioeducativo',
      'socioeduc_adolesc': 'Socioeducativo Adolesc'
    };

    // √çcones para cada tipo
    const TIPO_ICONS = {
      'indigena': 'üë•',
      'quilombola': 'üèõÔ∏è',
      'assentamento': 'üöú',
      'regular': 'üè´',
      'ceeja': 'üìö',
      'cel_jto': 'üéì',
      'hospitalar': 'üè•',
      'penitenciaria': 'üè¢',
      'socioeduc': 'üë¶',
      'socioeduc_adolesc': 'üë®‚Äçüéì'
    };

    // Inicializar dashboard
    async function initializeDashboard() {
      console.log('üöÄ Inicializando dashboard...');
      
      try {
        // Carregar dados das escolas
        await loadSchoolData();
        
        // Inicializar mapa
        initializeMap();
        
        // Gerar filtros
        generateFilters();
        
        // Configurar busca
        setupSearch();
        
        // Aplicar filtro inicial
        applyFilter('all');
        
        console.log('‚úÖ Dashboard inicializado com sucesso!');
        
      } catch (error) {
        console.error('‚ùå Erro ao inicializar dashboard:', error);
        showError('Erro ao carregar dashboard. Tente recarregar a p√°gina.');
      }
    }

    // Carregar dados das escolas
    async function loadSchoolData() {
      console.log('üìä Carregando dados das escolas...');
      
      try {
        // Tentar carregar arquivo JSON
        const response = await fetch('dados/json/dados_escolas_atualizados_completo.json');
        
        if (!response.ok) {
          throw new Error('Arquivo n√£o encontrado');
        }
        
        schoolsData = await response.json();
        console.log(`‚úÖ ${schoolsData.length} escolas carregadas`);
        
      } catch (error) {
        console.log('‚ö†Ô∏è Arquivo JSON n√£o encontrado, gerando dados de exemplo...');
        
        // Dados de exemplo para demonstra√ß√£o
        schoolsData = generateExampleData();
        console.log(`‚úÖ ${schoolsData.length} escolas de exemplo geradas`);
      }
    }

    // Gerar dados de exemplo para demonstra√ß√£o
    function generateExampleData() {
      const exemplos = [
        {
          name: "ALDEIA NIMUENDAJU",
          type: "indigena",
          city: "AVAI",
          diretoria: "BAURU",
          lat: -22.29116058,
          lng: -49.37730026,
          codigo_mec: "35100146",
          zona: "Rural"
        },
        {
          name: "JOAO CARREIRA",
          type: "quilombola", 
          city: "ANDRADINA",
          diretoria: "ANDRADINA",
          lat: -21.0112896,
          lng: -51.46931458,
          codigo_mec: "35905914",
          zona: "Rural"
        },
        {
          name: "BAIRRO DE BOMBAS",
          type: "assentamento",
          city: "IPORANGA",
          diretoria: "APIAI",
          lat: -24.6093597,
          lng: -48.65967178,
          codigo_mec: "35030001",
          zona: "Rural"
        },
        {
          name: "HELEN KELLER",
          type: "regular",
          city: "ADAMANTINA", 
          diretoria: "ADAMANTINA",
          lat: -21.69298935,
          lng: -51.06887817,
          codigo_mec: "35030806",
          zona: "Urbana"
        }
      ];

      // Gerar mais escolas para demonstra√ß√£o
      const data = [...exemplos];
      
      for (let i = 0; i < 100; i++) {
        const tipos = Object.keys(ESCOLA_COLORS);
        const tipo = tipos[Math.floor(Math.random() * tipos.length)];
        
        data.push({
          name: `ESCOLA EXEMPLO ${i + 1}`,
          type: tipo,
          city: `CIDADE ${i + 1}`,
          diretoria: `DIRETORIA ${(i % 10) + 1}`,
          lat: -23.5 + (Math.random() - 0.5) * 10,
          lng: -46.6 + (Math.random() - 0.5) * 10,
          codigo_mec: `35${String(i).padStart(6, '0')}`,
          zona: Math.random() > 0.5 ? "Urbana" : "Rural"
        });
      }
      
      return data;
    }

    // Inicializar mapa
    function initializeMap() {
      console.log('üó∫Ô∏è Inicializando mapa...');
      
      map = L.map('map').setView([-23.5, -46.6], 7);
      
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
      }).addTo(map);
      
      console.log('‚úÖ Mapa inicializado');
    }

    // Gerar filtros dinamicamente
    function generateFilters() {
      const typeFilters = document.getElementById('type-filters');
      const legendContent = document.getElementById('map-legend-content');
      
      // Contar tipos
      const typeCounts = {};
      schoolsData.forEach(school => {
        typeCounts[school.type] = (typeCounts[school.type] || 0) + 1;
      });

      // Bot√£o "Todas"
      const allButton = document.createElement('button');
      allButton.className = 'type-filter-btn active';
      allButton.dataset.type = 'all';
      allButton.innerHTML = `
        <span class="filter-icon">üè´</span>
        <span class="filter-text">Todas (${schoolsData.length})</span>
      `;
      allButton.addEventListener('click', () => applyFilter('all'));
      typeFilters.appendChild(allButton);

      // Bot√µes por tipo
      Object.keys(typeCounts).forEach(tipo => {
        const button = document.createElement('button');
        button.className = 'type-filter-btn';
        button.dataset.type = tipo;
        button.innerHTML = `
          <span class="filter-icon">${TIPO_ICONS[tipo] || 'üìç'}</span>
          <span class="filter-text">${TIPO_NAMES[tipo] || tipo} (${typeCounts[tipo]})</span>
        `;
        button.addEventListener('click', () => applyFilter(tipo));
        typeFilters.appendChild(button);

        // Adicionar √† legenda
        const legendItem = document.createElement('div');
        legendItem.className = 'legend-item';
        legendItem.innerHTML = `
          <span class="legend-icon" style="color: ${ESCOLA_COLORS[tipo] || '#666'};">‚óè</span>
          <span>${TIPO_NAMES[tipo] || tipo} (${typeCounts[tipo]})</span>
        `;
        legendContent.appendChild(legendItem);
      });

      // Atualizar estat√≠sticas
      document.getElementById('total-schools').textContent = schoolsData.length.toLocaleString('pt-BR');
    }

    // Aplicar filtro
    function applyFilter(filterType) {
      currentFilter = filterType;
      
      // Atualizar bot√µes ativos
      document.querySelectorAll('.type-filter-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.dataset.type === filterType) {
          btn.classList.add('active');
        }
      });

      // Filtrar escolas
      if (filterType === 'all') {
        filteredSchools = schoolsData;
      } else {
        filteredSchools = schoolsData.filter(school => school.type === filterType);
      }

      // Atualizar mapa e lista
      updateMap();
      updateSchoolList();
      
      console.log(`üîç Filtro aplicado: ${filterType} - ${filteredSchools.length} escolas`);
    }

    // Atualizar marcadores no mapa
    function updateMap() {
      // Limpar marcadores existentes
      schoolMarkers.forEach(marker => map.removeLayer(marker));
      schoolMarkers = [];

      // Adicionar novos marcadores
      filteredSchools.forEach(school => {
        if (school.lat && school.lng) {
          const color = ESCOLA_COLORS[school.type] || '#666666';
          
          const marker = L.circleMarker([school.lat, school.lng], {
            radius: 6,
            fillColor: color,
            color: '#fff',
            weight: 2,
            opacity: 1,
            fillOpacity: 0.8
          });

          const popupContent = `
            <div style="min-width: 200px;">
              <h4>${school.name}</h4>
              <p><strong>Tipo:</strong> ${TIPO_NAMES[school.type] || school.type}</p>
              <p><strong>Munic√≠pio:</strong> ${school.city}</p>
              <p><strong>Unidade Regional:</strong> ${school.diretoria}</p>
              <p><strong>C√≥digo MEC:</strong> ${school.codigo_mec}</p>
              <p><strong>Zona:</strong> ${school.zona}</p>
            </div>
          `;

          marker.bindPopup(popupContent);
          marker.addTo(map);
          schoolMarkers.push(marker);
        }
      });
    }

    // Atualizar lista de escolas
    function updateSchoolList() {
      const schoolList = document.getElementById('school-list');
      schoolList.innerHTML = '';

      if (filteredSchools.length === 0) {
        schoolList.innerHTML = '<div class="loading">Nenhuma escola encontrada</div>';
        return;
      }

      // Limitar para performance
      const maxDisplay = 50;
      const schoolsToShow = filteredSchools.slice(0, maxDisplay);

      if (filteredSchools.length > maxDisplay) {
        const notice = document.createElement('div');
        notice.style.cssText = 'padding: 15px; background: #fff3cd; border-radius: 10px; margin-bottom: 15px; text-align: center;';
        notice.innerHTML = `
          <p>üìã Mostrando ${maxDisplay} de ${filteredSchools.length.toLocaleString('pt-BR')} escolas</p>
          <small>Use os filtros ou a busca para refinar os resultados</small>
        `;
        schoolList.appendChild(notice);
      }

      schoolsToShow.forEach(school => {
        const schoolItem = document.createElement('div');
        schoolItem.className = 'school-item';
        
        schoolItem.innerHTML = `
          <h4 class="school-name">${school.name}</h4>
          <div class="school-details">
            <p><strong>Tipo:</strong> ${TIPO_NAMES[school.type] || school.type}</p>
            <p><strong>Munic√≠pio:</strong> ${school.city}</p>
            <p><strong>Unidade Regional:</strong> ${school.diretoria}</p>
            <p><strong>C√≥digo:</strong> ${school.codigo_mec}</p>
          </div>
        `;

        schoolItem.addEventListener('click', () => {
          if (school.lat && school.lng) {
            map.setView([school.lat, school.lng], 12);
            
            const marker = schoolMarkers.find(m => 
              Math.abs(m.getLatLng().lat - school.lat) < 0.0001 && 
              Math.abs(m.getLatLng().lng - school.lng) < 0.0001
            );
            
            if (marker) {
              marker.openPopup();
            }
          }
        });

        schoolList.appendChild(schoolItem);
      });
    }

    // Configurar busca
    function setupSearch() {
      const searchInput = document.getElementById('search-input');
      
      searchInput.addEventListener('input', function() {
        const searchTerm = this.value.toLowerCase().trim();
        
        if (searchTerm === '') {
          applyFilter(currentFilter);
          return;
        }

        // Filtrar por termo de busca
        const baseSchools = currentFilter === 'all' ? schoolsData : 
          schoolsData.filter(school => school.type === currentFilter);
        
        filteredSchools = baseSchools.filter(school => 
          school.name.toLowerCase().includes(searchTerm) ||
          school.city.toLowerCase().includes(searchTerm) ||
          school.diretoria.toLowerCase().includes(searchTerm)
        );

        updateMap();
        updateSchoolList();
      });
    }

    // Mostrar erro
    function showError(message) {
      const schoolList = document.getElementById('school-list');
      schoolList.innerHTML = `
        <div style="padding: 20px; background: #f8d7da; color: #721c24; border-radius: 10px; text-align: center;">
          <h4>‚ùå Erro</h4>
          <p>${message}</p>
        </div>
      `;
    }

    // Inicializar quando a p√°gina carregar
    document.addEventListener('DOMContentLoaded', initializeDashboard);
  </script>
</body>

</html>
