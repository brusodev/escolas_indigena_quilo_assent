<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard Integrado - Escolas √ó Diretorias √ó Frota</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.css" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }

    .header {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px;
      text-align: center;
      box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .header h1 {
      color: #2c3e50;
      margin-bottom: 10px;
      font-size: 2.2em;
    }

    .header .subtitle {
      color: #7f8c8d;
      font-style: italic;
      font-size: 1.1em;
    }

    .main-container {
      max-width: 1600px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .dashboard-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin-bottom: 20px;
    }

    .stats-section {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 15px;
      margin-bottom: 20px;
    }

    .stat-card {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      text-align: center;
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .stat-number {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 5px;
    }

    .stat-label {
      color: #7f8c8d;
      font-size: 0.9em;
      font-weight: 500;
    }

    .escolas .stat-number {
      color: #e74c3c;
    }

    .veiculos .stat-number {
      color: #3498db;
    }

    .diretorias .stat-number {
      color: #9b59b6;
    }

    .distancia .stat-number {
      color: #f39c12;
    }

    .demanda .stat-number {
      color: #e67e22;
    }

    .panel {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .panel h3 {
      color: #2c3e50;
      margin-bottom: 15px;
      font-size: 1.3em;
    }

    #map {
      height: 500px;
      border-radius: 10px;
      overflow: hidden;
    }

    .charts-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
      margin: 20px 0;
    }

    .chart-panel {
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    .chart-container {
      position: relative;
      height: 300px;
    }

    .filters {
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 15px;
      border: 1px solid rgba(255, 255, 255, 0.3);
    }

    .filter-group {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
      flex-wrap: wrap;
    }

    .filter-btn {
      padding: 8px 16px;
      border: 2px solid #e0e0e0;
      background: white;
      border-radius: 25px;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.9em;
      font-weight: 500;
    }

    .filter-btn.active {
      background: #3498db;
      color: white;
      border-color: #3498db;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(52, 152, 219, 0.3);
    }

    .filter-btn:hover {
      transform: translateY(-1px);
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    }

    .search-box {
      width: 100%;
      padding: 12px;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 0.9em;
    }

    .school-list {
      max-height: 400px;
      overflow-y: auto;
      padding-right: 10px;
    }

    .school-item {
      background: white;
      padding: 15px;
      border-radius: 10px;
      margin-bottom: 10px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
      cursor: pointer;
      transition: all 0.3s;
      border-left: 4px solid transparent;
    }

    .school-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    }

    .school-item.indigena {
      border-left-color: #e74c3c;
    }

    .school-item.quilombola {
      border-left-color: #27ae60;
    }

    .school-name {
      font-weight: bold;
      color: #2c3e50;
      margin-bottom: 8px;
      font-size: 0.95em;
    }

    .school-details {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 5px;
      font-size: 0.85em;
      color: #7f8c8d;
    }

    .distance {
      background: #f8f9fa;
      padding: 8px;
      border-radius: 6px;
      text-align: center;
      margin-top: 8px;
      font-weight: bold;
      grid-column: 1 / -1;
    }

    .distance.close {
      background: #d4edda;
      color: #155724;
    }

    .distance.medium {
      background: #fff3cd;
      color: #856404;
    }

    .distance.far {
      background: #f8d7da;
      color: #721c24;
    }

    .priority-high {
      border-left-color: #e74c3c !important;
    }

    .priority-medium {
      border-left-color: #f39c12 !important;
    }

    .priority-low {
      border-left-color: #27ae60 !important;
    }

    .legend {
      background: rgba(255, 255, 255, 0.9);
      padding: 15px;
      border-radius: 10px;
      margin-top: 15px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 8px;
    }

    .legend-icon {
      width: 20px;
      height: 20px;
      border-radius: 50%;
      margin-right: 10px;
      border: 2px solid white;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.3);
    }

    .indigena-marker {
      background-color: #e74c3c;
    }

    .quilombola-marker {
      background-color: #27ae60;
    }

    .diretoria-marker {
      background-color: #3498db;
    }

    .vehicle-info {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
      padding: 10px;
      border-radius: 8px;
      margin-top: 10px;
      text-align: center;
      font-weight: 500;
    }

    .no-vehicles {
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
    }

    .has-vehicles {
      background: linear-gradient(135deg, #00d2d3, #54a0ff);
    }

    @media (max-width: 1200px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .charts-container {
        grid-template-columns: 1fr;
      }

      .stats-section {
        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
      }
    }

    @media (max-width: 768px) {
      .header h1 {
        font-size: 1.8em;
      }

      .header .subtitle {
        font-size: 1em;
      }

      .stat-number {
        font-size: 2em;
      }
    }
  </style>
</head>

<body>
  <div class="header">
    <h1>üéØ Dashboard Integrado - An√°lise de Frota</h1>
    <p class="subtitle">Escolas Ind√≠genas, Quilombolas e de Assentamentos √ó Diretorias √ó Ve√≠culos</p>
  </div>

  <div class="main-container">
    <!-- Estat√≠sticas Gerais -->
    <div class="stats-section">
      <div class="stat-card escolas">
        <div class="stat-number" id="total-schools">59</div>
        <div class="stat-label">Total de Escolas</div>
      </div>
      <div class="stat-card veiculos">
        <div class="stat-number" id="total-vehicles">6</div>
        <div class="stat-label">Total de Ve√≠culos</div>
      </div>
      <div class="stat-card diretorias">
        <div class="stat-number" id="total-diretorias">17</div>
        <div class="stat-label">Diretorias</div>
      </div>
      <div class="stat-card distancia">
        <div class="stat-number" id="avg-distance">50.6</div>
        <div class="stat-label">Dist√¢ncia M√©dia (km)</div>
      </div>
      <div class="stat-card demanda">
        <div class="stat-number" id="high-priority">25</div>
        <div class="stat-label">Escolas >50km</div>
      </div>
    </div>

    <!-- Gr√°ficos de An√°lise -->
    <div class="charts-container">
      <div class="chart-panel">
        <h3>üìä Ve√≠culos vs Demanda por Diretoria</h3>
        <div class="chart-container">
          <canvas id="vehicleChart"></canvas>
        </div>
      </div>
      <div class="chart-panel">
        <h3>üéØ Prioridade de Atendimento</h3>
        <div class="chart-container">
          <canvas id="priorityChart"></canvas>
        </div>
      </div>
    </div>

    <!-- Dashboard Principal -->
    <div class="dashboard-grid">
      <!-- Mapa -->
      <div class="panel">
        <h3>üó∫Ô∏è Mapa Interativo</h3>
        <div id="map"></div>

        <div class="legend">
          <h4>Legenda</h4>
          <div class="legend-item">
            <div class="legend-icon indigena-marker"></div>
            <span>Escola Ind√≠gena (43 escolas)</span>
          </div>
          <div class="legend-item">
            <div class="legend-icon quilombola-marker"></div>
            <span>Escola Quilombola/Assentamento (16 escolas)</span>
          </div>
          <div class="legend-item">
            <div class="legend-icon diretoria-marker"></div>
            <span>Diretoria de Ensino</span>
          </div>
        </div>
      </div>

      <!-- Lista de Escolas -->
      <div class="panel">
        <h3>üìã Escolas por Prioridade</h3>

        <div class="filters">
          <div class="filter-group">
            <button class="filter-btn active" data-filter="all">Todas</button>
            <button class="filter-btn" data-filter="indigena">Ind√≠genas</button>
            <button class="filter-btn" data-filter="quilombola">Quilombolas</button>
            <button class="filter-btn" data-filter="priority-high">Alta Prioridade</button>
          </div>
          <input type="text" class="search-box" placeholder="üîç Buscar escola, cidade ou diretoria..."
            id="search-input">
        </div>

        <div class="school-list" id="school-list">
          <!-- Escolas ser√£o carregadas aqui -->
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.7.1/leaflet.js"></script>
  <script>
    // Dados dos ve√≠culos por diretoria
    const vehicleData = {
      "CENTRO": { "total": 1, "s1": 0, "s2": 1, "s2_4x4": 0 },
      "CENTRO OESTE": { "total": 1, "s1": 0, "s2": 1, "s2_4x4": 0 },
      "NORTE 1": { "total": 1, "s1": 0, "s2": 1, "s2_4x4": 0 },
      "NORTE 2": { "total": 1, "s1": 0, "s2": 1, "s2_4x4": 0 },
      "LESTE 1": { "total": 1, "s1": 0, "s2": 1, "s2_4x4": 0 },
      "LESTE 2": { "total": 1, "s1": 0, "s2": 1, "s2_4x4": 0 },
      "ANDRADINA": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "AVARE": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "BAURU": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "CARAGUATATUBA": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "ITAPEVA": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "ITARARE": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "LINS": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "MIRACATU": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "MIRANTE DO PARANAPANEMA": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "SANTO ANASTACIO": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "PENAPOLIS": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "REGISTRO": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "SANTOS": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "SAO BERNARDO DO CAMPO": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "SAO VICENTE": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "LESTE 5": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 },
      "TUPA": { "total": 0, "s1": 0, "s2": 0, "s2_4x4": 0 }
    };

    // Dados das escolas (mesmos dados do arquivo original)
    const schoolsData = [
      {
        "name": "JOAO CARREIRA",
        "type": "quilombola",
        "city": "ANDRADINA",
        "diretoria": "Andradina",
        "distance": 16.1,
        "lat": -21.0112896,
        "lng": -51.46931458,
        "de_lat": -20.896505,
        "de_lng": -51.3742765
      },
      {
        "name": "ASSENTAMENTO ZUMBI DOS PALMARES",
        "type": "quilombola",
        "city": "IARAS",
        "diretoria": "Avare",
        "distance": 44.17,
        "lat": -22.75668907,
        "lng": -49.13655853,
        "de_lat": -23.1045215,
        "de_lng": -48.9259103
      },
      {
        "name": "ALDEIA NIMUENDAJU",
        "type": "indigena",
        "city": "AVAI",
        "diretoria": "Bauru",
        "distance": 30.08,
        "lat": -22.29116058,
        "lng": -49.37730026,
        "de_lat": -22.3268807,
        "de_lng": -49.0878538
      },
      {
        "name": "ALDEIA EKERUA",
        "type": "indigena",
        "city": "AVAI",
        "diretoria": "Bauru",
        "distance": 29.94,
        "lat": -22.2747097,
        "lng": -49.37297058,
        "de_lat": -22.3268807,
        "de_lng": -49.0878538
      },
      {
        "name": "ALDEIA TEREGUA",
        "type": "indigena",
        "city": "AVAI",
        "diretoria": "Bauru",
        "distance": 35.6,
        "lat": -22.16006088,
        "lng": -49.38312149,
        "de_lat": -22.3268807,
        "de_lng": -49.0878538
      },
      {
        "name": "ALDEIA KOPENOTI",
        "type": "indigena",
        "city": "AVAI",
        "diretoria": "Bauru",
        "distance": 285.9,
        "lat": -23.55051994,
        "lng": -46.63330841,
        "de_lat": -22.3268807,
        "de_lng": -49.0878538
      },
      {
        "name": "ALDEIA RENASCER",
        "type": "indigena",
        "city": "UBATUBA",
        "diretoria": "Caraguatatuba",
        "distance": 29.12,
        "lat": -23.47613907,
        "lng": -45.19160843,
        "de_lat": -23.6311508,
        "de_lng": -45.4219689
      },
      {
        "name": "ALDEIA BOA VISTA",
        "type": "indigena",
        "city": "UBATUBA",
        "diretoria": "Caraguatatuba",
        "distance": 54.17,
        "lat": -23.37615967,
        "lng": -44.96944046,
        "de_lat": -23.6311508,
        "de_lng": -45.4219689
      },
      {
        "name": "EE IDALICIO MENDES  LIMA O SR BAIANO DA AGROVILA I",
        "type": "quilombola",
        "city": "ITAPEVA",
        "diretoria": "Itapeva",
        "distance": 27.43,
        "lat": -24.1126194,
        "lng": -49.11140823,
        "de_lat": -23.9849105,
        "de_lng": -48.8803886
      },
      {
        "name": "TXONDARO TEKOA  MBAE",
        "type": "indigena",
        "city": "BARAO DE ANTONINA",
        "diretoria": "Itarare",
        "distance": 60.64,
        "lat": -23.61064911,
        "lng": -49.58242035,
        "de_lat": -24.109956,
        "de_lng": -49.3382138
      },
      {
        "name": "ALDEIA KARUGWA",
        "type": "indigena",
        "city": "BARAO DE ANTONINA",
        "diretoria": "Itarare",
        "distance": 61.64,
        "lat": -23.60279083,
        "lng": -49.58737946,
        "de_lat": -24.109956,
        "de_lng": -49.3382138
      },
      {
        "name": "ALDEIA YWY PYHAU",
        "type": "indigena",
        "city": "BARAO DE ANTONINA",
        "diretoria": "Itarare",
        "distance": 61.61,
        "lat": -23.5999794,
        "lng": -49.57976913,
        "de_lat": -24.109956,
        "de_lng": -49.3382138
      },
      {
        "name": "AGROVILA III",
        "type": "quilombola",
        "city": "ITABERA",
        "diretoria": "Itarare",
        "distance": 28.04,
        "lat": -24.01605034,
        "lng": -49.08214188,
        "de_lat": -24.109956,
        "de_lng": -49.3382138
      },
      {
        "name": "ALDEIA TEKOAPORA",
        "type": "indigena",
        "city": "ITAPORANGA",
        "diretoria": "Itarare",
        "distance": 50.17,
        "lat": -23.6990509,
        "lng": -49.54547119,
        "de_lat": -24.109956,
        "de_lng": -49.3382138
      },
      {
        "name": "COMUNIDADE NOSSA SENHORA APARECIDA",
        "type": "quilombola",
        "city": "PROMISSAO",
        "diretoria": "Lins",
        "distance": 38.24,
        "lat": -21.33078957,
        "lng": -49.79145813,
        "de_lat": -21.6741873,
        "de_lng": -49.7518932
      },
      {
        "name": "ALDEIA GWAWIRA",
        "type": "indigena",
        "city": "IGUAPE",
        "diretoria": "Miracatu",
        "distance": 65.04,
        "lat": -24.79512024,
        "lng": -47.76939011,
        "de_lat": -24.2839078,
        "de_lng": -47.4535128
      },
      {
        "name": "ALDEIA ITAPUA",
        "type": "indigena",
        "city": "IGUAPE",
        "diretoria": "Miracatu",
        "distance": 44.74,
        "lat": -24.68457985,
        "lng": -47.50952148,
        "de_lat": -24.2839078,
        "de_lng": -47.4535128
      },
      {
        "name": "TAGUATO AGUIA",
        "type": "indigena",
        "city": "IGUAPE",
        "diretoria": "Miracatu",
        "distance": 44.87,
        "lat": -24.68473053,
        "lng": -47.51789856,
        "de_lat": -24.2839078,
        "de_lng": -47.4535128
      },
      {
        "name": "ALDEIA CAPOEIRAO",
        "type": "indigena",
        "city": "ITARIRI",
        "diretoria": "Miracatu",
        "distance": 34.3,
        "lat": -24.30809021,
        "lng": -47.11671829,
        "de_lat": -24.2839078,
        "de_lng": -47.4535128
      },
      {
        "name": "ALDEIA RIO DO AZEITE",
        "type": "indigena",
        "city": "ITARIRI",
        "diretoria": "Miracatu",
        "distance": 29.13,
        "lat": -24.33348083,
        "lng": -47.17166138,
        "de_lat": -24.2839078,
        "de_lng": -47.4535128
      },
      {
        "name": "ALDEIA URUITY",
        "type": "indigena",
        "city": "MIRACATU",
        "diretoria": "Miracatu",
        "distance": 13.1,
        "lat": -24.26409912,
        "lng": -47.32629013,
        "de_lat": -24.2839078,
        "de_lng": -47.4535128
      },
      {
        "name": "ALDEIA DJAIKOATY",
        "type": "indigena",
        "city": "MIRACATU",
        "diretoria": "Miracatu",
        "distance": 12.63,
        "lat": -24.20033073,
        "lng": -47.36891937,
        "de_lat": -24.2839078,
        "de_lng": -47.4535128
      },
      {
        "name": "KO E JU",
        "type": "indigena",
        "city": "MIRACATU",
        "diretoria": "Miracatu",
        "distance": 18.33,
        "lat": -24.15617943,
        "lng": -47.33876038,
        "de_lat": -24.2839078,
        "de_lng": -47.4535128
      },
      {
        "name": "LIDIA SANAE OYA",
        "type": "quilombola",
        "city": "EUCLIDES DA CUNHA PAULISTA",
        "diretoria": "Mirante do Paranapanema",
        "distance": 65.91,
        "lat": -22.57377052,
        "lng": -52.47143936,
        "de_lat": -22.2925861,
        "de_lng": -51.907143
      },
      {
        "name": "MARIA ANTONIA ZANGARINI FERREIRA PROFESSORA",
        "type": "quilombola",
        "city": "EUCLIDES DA CUNHA PAULISTA",
        "diretoria": "Mirante do Paranapanema",
        "distance": 82.67,
        "lat": -22.47491074,
        "lng": -52.68555069,
        "de_lat": -22.2925861,
        "de_lng": -51.907143
      },
      {
        "name": "ASSENTAMENTO SANTA CLARA",
        "type": "quilombola",
        "city": "MIRANTE DO PARANAPANEMA",
        "diretoria": "Mirante do Paranapanema",
        "distance": 28.03,
        "lat": -22.51530647,
        "lng": -52.03659058,
        "de_lat": -22.2925861,
        "de_lng": -51.907143
      },
      {
        "name": "FAZENDA SAO BENTO",
        "type": "quilombola",
        "city": "MIRANTE DO PARANAPANEMA",
        "diretoria": "Mirante do Paranapanema",
        "distance": 17.99,
        "lat": -22.43954086,
        "lng": -51.9817009,
        "de_lat": -22.2925861,
        "de_lng": -51.907143
      },
      {
        "name": "GLEBA XV DE NOVEMBRO",
        "type": "quilombola",
        "city": "ROSANA",
        "diretoria": "Mirante do Paranapanema",
        "distance": 91.11,
        "lat": -22.46820068,
        "lng": -52.77148056,
        "de_lat": -22.2925861,
        "de_lng": -51.907143
      },
      {
        "name": "RIBEIRINHOS",
        "type": "quilombola",
        "city": "ROSANA",
        "diretoria": "Mirante do Paranapanema",
        "distance": 83.26,
        "lat": -22.45060921,
        "lng": -52.69752884,
        "de_lat": -22.2925861,
        "de_lng": -51.907143
      },
      {
        "name": "ROMILDA LAZARA PILLON DOS SANTOS PROFESSORA",
        "type": "quilombola",
        "city": "TEODORO SAMPAIO",
        "diretoria": "Mirante do Paranapanema",
        "distance": 41.85,
        "lat": -22.31339073,
        "lng": -52.31266022,
        "de_lat": -22.2925861,
        "de_lng": -51.907143
      },
      {
        "name": "ASSENTAMENTO SANTA ZELIA",
        "type": "quilombola",
        "city": "TEODORO SAMPAIO",
        "diretoria": "Mirante do Paranapanema",
        "distance": 54.04,
        "lat": -22.37401009,
        "lng": -52.42435074,
        "de_lat": -22.2925861,
        "de_lng": -51.907143
      },
      {
        "name": "ANTONIA BINATO SILVA VO NINA",
        "type": "quilombola",
        "city": "TEODORO SAMPAIO",
        "diretoria": "Mirante do Paranapanema",
        "distance": 63.41,
        "lat": -22.35367012,
        "lng": -52.51908112,
        "de_lat": -22.2925861,
        "de_lng": -51.907143
      },
      {
        "name": "FRANCISCO FERREIRA DE SOUZA PROFESSOR",
        "type": "quilombola",
        "city": "TEODORO SAMPAIO",
        "diretoria": "Mirante do Paranapanema",
        "distance": 53.77,
        "lat": -22.48542023,
        "lng": -52.38634109,
        "de_lat": -22.2925861,
        "de_lng": -51.907143
      },
      {
        "name": "DJEKUPE AMBA ARANDY",
        "type": "indigena",
        "city": "SAO PAULO",
        "diretoria": "Leste 5",
        "distance": 72.4,
        "lat": -23.46372986,
        "lng": -46.75337982,
        "de_lat": -23.9782834,
        "de_lng": -46.3154982
      },
      {
        "name": "INDIA MARIA ROSA",
        "type": "indigena",
        "city": "BRAUNA",
        "diretoria": "Penapolis",
        "distance": 29.76,
        "lat": -21.5655098,
        "lng": -50.31747818,
        "de_lat": -21.4192406,
        "de_lng": -50.0765588
      },
      {
        "name": "ESCOLA ESTADUAL INDIGENA  ALDEIA MAENDUA PORA",
        "type": "indigena",
        "city": "CANANEIA",
        "diretoria": "Registro",
        "distance": 66.48,
        "lat": -25.03816032,
        "lng": -48.14419937,
        "de_lat": -24.5059582,
        "de_lng": -47.8403722
      },
      {
        "name": "ALDEIA SANTA CRUZ",
        "type": "indigena",
        "city": "CANANEIA",
        "diretoria": "Registro",
        "distance": 70.27,
        "lat": -25.1335907,
        "lng": -47.9416008,
        "de_lat": -24.5059582,
        "de_lng": -47.8403722
      },
      {
        "name": "ALDEIA RIO BRANCO II",
        "type": "indigena",
        "city": "CANANEIA",
        "diretoria": "Registro",
        "distance": 61.75,
        "lat": -25.03256035,
        "lng": -48.04067993,
        "de_lat": -24.5059582,
        "de_lng": -47.8403722
      },
      {
        "name": "ALDEIA TAKUARI TY",
        "type": "indigena",
        "city": "CANANEIA",
        "diretoria": "Registro",
        "distance": 57.2,
        "lat": -25.01310921,
        "lng": -47.94667816,
        "de_lat": -24.5059582,
        "de_lng": -47.8403722
      },
      {
        "name": "ALDEIA TAQUARI",
        "type": "indigena",
        "city": "ELDORADO",
        "diretoria": "Registro",
        "distance": 36.66,
        "lat": -24.46722031,
        "lng": -48.19955826,
        "de_lat": -24.5059582,
        "de_lng": -47.8403722
      },
      {
        "name": "ALDEIA PINDO TY",
        "type": "indigena",
        "city": "PARIQUERA-ACU",
        "diretoria": "Registro",
        "distance": 27.19,
        "lat": -24.75048065,
        "lng": -47.86373138,
        "de_lat": -24.5059582,
        "de_lng": -47.8403722
      },
      {
        "name": "ALDEIA ARACA MIRIM",
        "type": "indigena",
        "city": "PARIQUERA-ACU",
        "diretoria": "Registro",
        "distance": 23.56,
        "lat": -24.71689987,
        "lng": -47.87017822,
        "de_lat": -24.5059582,
        "de_lng": -47.8403722
      },
      {
        "name": "ALDEIA ITAPU MIRIM",
        "type": "indigena",
        "city": "REGISTRO",
        "diretoria": "Registro",
        "distance": 16.38,
        "lat": -24.51189041,
        "lng": -48.00183868,
        "de_lat": -24.5059582,
        "de_lng": -47.8403722
      },
      {
        "name": "ALDEIA PEGUAO TY",
        "type": "indigena",
        "city": "SETE BARRAS",
        "diretoria": "Registro",
        "distance": 53.34,
        "lat": -24.28780937,
        "lng": -48.30912018,
        "de_lat": -24.5059582,
        "de_lng": -47.8403722
      },
      {
        "name": "PROJETO LAGOA SAO PAULO",
        "type": "quilombola",
        "city": "CAIUA",
        "diretoria": "Santo Anastacio",
        "distance": 45.34,
        "lat": -21.6774292,
        "lng": -51.95434189,
        "de_lat": -21.974662,
        "de_lng": -51.652662
      },
      {
        "name": "TXERU BA  E KUA  I",
        "type": "indigena",
        "city": "BERTIOGA",
        "diretoria": "Santos",
        "distance": 58.46,
        "lat": -23.75160027,
        "lng": -45.78998947,
        "de_lat": -23.9335988,
        "de_lng": -46.3286399
      },
      {
        "name": "CLASSES VINCULADAS A EE OMAR DONATO BASSANI",
        "type": "indigena",
        "city": "SAO BERNARDO DO CAMPO",
        "diretoria": "Sao Bernardo do Campo",
        "distance": 17.41,
        "lat": -23.85606956,
        "lng": -46.60800934,
        "de_lat": -23.7080345,
        "de_lng": -46.5506747
      },
      {
        "name": "ALDEIA RIO BRANCO",
        "type": "indigena",
        "city": "ITANHAEM",
        "diretoria": "Sao Vicente",
        "distance": 63.08,
        "lat": -24.14668083,
        "lng": -46.80730057,
        "de_lat": -23.6637075,
        "de_lng": -46.4790626
      },
      {
        "name": "ALDEIA TANGARA",
        "type": "indigena",
        "city": "ITANHAEM",
        "diretoria": "Sao Vicente",
        "distance": 68.55,
        "lat": -24.16555023,
        "lng": -46.87303162,
        "de_lat": -23.6637075,
        "de_lng": -46.4790626
      },
      {
        "name": "KUARAY O E A SOL NASCENTE",
        "type": "indigena",
        "city": "MONGAGUA",
        "diretoria": "Sao Vicente",
        "distance": 54.22,
        "lat": -24.11581039,
        "lng": -46.68315125,
        "de_lat": -23.6637075,
        "de_lng": -46.4790626
      },
      {
        "name": "ALDEIA AGUAPEU",
        "type": "indigena",
        "city": "MONGAGUA",
        "diretoria": "Sao Vicente",
        "distance": 50.0,
        "lat": -24.08580971,
        "lng": -46.65306091,
        "de_lat": -23.6637075,
        "de_lng": -46.4790626
      },
      {
        "name": "ALDEIA NHAMANDU MIRIM",
        "type": "indigena",
        "city": "PERUIBE",
        "diretoria": "Sao Vicente",
        "distance": 87.64,
        "lat": -24.28722954,
        "lng": -47.00923157,
        "de_lat": -23.6637075,
        "de_lng": -46.4790626
      },
      {
        "name": "ALDEIA BANANAL",
        "type": "indigena",
        "city": "PERUIBE",
        "diretoria": "Sao Vicente",
        "distance": 83.75,
        "lat": -24.26161003,
        "lng": -46.98276901,
        "de_lat": -23.6637075,
        "de_lng": -46.4790626
      },
      {
        "name": "ALDEIA PIACAGUERA",
        "type": "indigena",
        "city": "PERUIBE",
        "diretoria": "Sao Vicente",
        "distance": 77.83,
        "lat": -24.24653053,
        "lng": -46.90629959,
        "de_lat": -23.6637075,
        "de_lng": -46.4790626
      },
      {
        "name": "ALDEIA TEKOA MIRIM",
        "type": "indigena",
        "city": "PRAIA GRANDE",
        "diretoria": "Sao Vicente",
        "distance": 37.9,
        "lat": -24.00324059,
        "lng": -46.52542877,
        "de_lat": -23.6637075,
        "de_lng": -46.4790626
      },
      {
        "name": "ALDEIA DE PARANAPUA",
        "type": "indigena",
        "city": "SAO VICENTE",
        "diretoria": "Sao Vicente",
        "distance": 36.75,
        "lat": -23.98343086,
        "lng": -46.3825798,
        "de_lat": -23.6637075,
        "de_lng": -46.4790626
      },
      {
        "name": "KRUKUTU",
        "type": "indigena",
        "city": "SAO PAULO",
        "diretoria": "Leste 5",
        "distance": 33.54,
        "lat": -23.86470985,
        "lng": -46.62084961,
        "de_lat": -23.9782834,
        "de_lng": -46.3154982
      },
      {
        "name": "INDIGENA GUARANI GWYRA PEPO",
        "type": "indigena",
        "city": "SAO PAULO",
        "diretoria": "Leste 5",
        "distance": 36.24,
        "lat": -23.86746979,
        "lng": -46.65039063,
        "de_lat": -23.9782834,
        "de_lng": -46.3154982
      },
      {
        "name": "INDIA VANUIRE",
        "type": "indigena",
        "city": "ARCO-IRIS",
        "diretoria": "Tupa",
        "distance": 20.4,
        "lat": -21.79439926,
        "lng": -50.38648987,
        "de_lat": -21.9349129,
        "de_lng": -50.5141255
      }
    ];

    // Calcular estat√≠sticas
    function calculateStats() {
      const totalVehicles = Object.values(vehicleData).reduce((sum, v) => sum + v.total, 0);
      const highPrioritySchools = schoolsData.filter(s => s.distance > 50).length;
      const uniqueDiretorias = [...new Set(schoolsData.map(s => s.diretoria))].length;

      document.getElementById('total-vehicles').textContent = totalVehicles;
      document.getElementById('high-priority').textContent = highPrioritySchools;
      document.getElementById('total-diretorias').textContent = uniqueDiretorias;
    }

    // Fun√ß√£o para calcular prioridade de uma escola
    function calculatePriority(school) {
      const vehicles = vehicleData[school.diretoria.toUpperCase()] || { total: 0 };

      if (school.distance > 50 && vehicles.total === 0) return 'high';
      if (school.distance > 30 && vehicles.total === 0) return 'medium';
      return 'low';
    }

    // Adicionar informa√ß√£o de prioridade √†s escolas
    schoolsData.forEach(school => {
      school.priority = calculatePriority(school);
    });

    // Inicializar mapa
    const map = L.map('map').setView([-23.5, -47.0], 7);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '¬© OpenStreetMap contributors'
    }).addTo(map);

    const schoolMarkers = L.layerGroup().addTo(map);
    const diretoriaMarkers = L.layerGroup().addTo(map);
    const connectionLines = L.layerGroup().addTo(map);

    // Adicionar marcadores das escolas
    function addSchoolMarkers(schools) {
      schoolMarkers.clearLayers();

      schools.forEach(school => {
        const color = school.type === 'indigena' ? '#e74c3c' : '#27ae60';
        const typeText = school.type === 'indigena' ? 'Ind√≠gena' : 'Quilombola/Assentamento';
        const vehicles = vehicleData[school.diretoria.toUpperCase()] || { total: 0 };

        const marker = L.circleMarker([school.lat, school.lng], {
          color: 'white',
          fillColor: color,
          fillOpacity: 0.8,
          radius: school.priority === 'high' ? 10 : 8,
          weight: school.priority === 'high' ? 3 : 2
        }).addTo(schoolMarkers);

        marker.bindPopup(`
          <div style="min-width: 280px;">
            <h4 style="margin: 0 0 10px 0; color: #2c3e50;">${school.name}</h4>
            <p style="margin: 5px 0;"><strong>Tipo:</strong> ${typeText}</p>
            <p style="margin: 5px 0;"><strong>Cidade:</strong> ${school.city}</p>
            <p style="margin: 5px 0;"><strong>Diretoria:</strong> ${school.diretoria}</p>
            <p style="margin: 5px 0;"><strong>Dist√¢ncia:</strong> ${school.distance} km</p>
            <p style="margin: 5px 0;"><strong>Prioridade:</strong> ${school.priority === 'high' ? 'üî¥ Alta' : school.priority === 'medium' ? 'üü° M√©dia' : 'üü¢ Baixa'}</p>
            <p style="margin: 5px 0;"><strong>Ve√≠culos na Diretoria:</strong> ${vehicles.total}</p>
            <button onclick="showConnection(${school.lat}, ${school.lng}, ${school.de_lat}, ${school.de_lng})" 
                    style="background: #3498db; color: white; border: none; padding: 5px 10px; border-radius: 3px; cursor: pointer; margin-top: 5px;">
                Mostrar Conex√£o
            </button>
          </div>
        `);
      });
    }

    // Adicionar marcadores das diretorias
    function addDiretoriaMarkers() {
      const diretorias = [...new Map(schoolsData.map(school =>
        [school.diretoria, {
          name: school.diretoria,
          lat: school.de_lat,
          lng: school.de_lng
        }]
      )).values()];

      diretorias.forEach(diretoria => {
        const vehicles = vehicleData[diretoria.name.toUpperCase()] || { total: 0 };
        const color = vehicles.total > 0 ? '#27ae60' : '#e74c3c';

        const marker = L.circleMarker([diretoria.lat, diretoria.lng], {
          color: 'white',
          fillColor: color,
          fillOpacity: 0.9,
          radius: vehicles.total > 0 ? 8 : 6,
          weight: 2
        }).addTo(diretoriaMarkers);

        marker.bindPopup(`
          <div style="min-width: 220px;">
            <h4 style="margin: 0 0 10px 0; color: #2c3e50;">DE ${diretoria.name}</h4>
            <p style="margin: 5px 0;"><strong>Ve√≠culos S-1:</strong> ${vehicles.s1}</p>
            <p style="margin: 5px 0;"><strong>Ve√≠culos S-2:</strong> ${vehicles.s2}</p>
            <p style="margin: 5px 0;"><strong>Ve√≠culos S-2 4x4:</strong> ${vehicles.s2_4x4}</p>
            <p style="margin: 10px 0 5px 0;"><strong>Total:</strong> ${vehicles.total} ve√≠culos</p>
            <p style="margin: 5px 0;"><strong>Status:</strong> ${vehicles.total > 0 ? '‚úÖ Com frota' : '‚ùå Sem frota'}</p>
          </div>
        `);
      });
    }

    // Fun√ß√£o para mostrar conex√£o
    function showConnection(schoolLat, schoolLng, dirLat, dirLng) {
      connectionLines.clearLayers();

      const line = L.polyline([
        [schoolLat, schoolLng],
        [dirLat, dirLng]
      ], {
        color: '#f39c12',
        weight: 3,
        opacity: 0.7,
        dashArray: '10, 10'
      }).addTo(connectionLines);

      map.fitBounds(line.getBounds(), { padding: [20, 20] });

      setTimeout(() => {
        connectionLines.clearLayers();
      }, 5000);
    }

    // Renderizar lista de escolas com prioridade
    function renderSchoolList(schools) {
      const container = document.getElementById('school-list');
      container.innerHTML = '';

      // Ordenar por prioridade
      const sortedSchools = schools.sort((a, b) => {
        const priorityOrder = { 'high': 0, 'medium': 1, 'low': 2 };
        if (priorityOrder[a.priority] !== priorityOrder[b.priority]) {
          return priorityOrder[a.priority] - priorityOrder[b.priority];
        }
        return b.distance - a.distance;
      });

      sortedSchools.forEach(school => {
        const distanceClass = school.distance < 30 ? 'close' : school.distance < 60 ? 'medium' : 'far';
        const typeText = school.type === 'indigena' ? 'Ind√≠gena' : 'Quilombola/Assentamento';
        const vehicles = vehicleData[school.diretoria.toUpperCase()] || { total: 0 };

        const schoolItem = document.createElement('div');
        schoolItem.className = `school-item ${school.type} priority-${school.priority}`;
        schoolItem.innerHTML = `
          <div class="school-name">${school.name}</div>
          <div class="school-details">
            <div class="detail-item">
              <span class="detail-label">Tipo:</span> ${typeText}
            </div>
            <div class="detail-item">
              <span class="detail-label">Cidade:</span> ${school.city}
            </div>
            <div class="detail-item">
              <span class="detail-label">Diretoria:</span> ${school.diretoria}
            </div>
            <div class="detail-item">
              <span class="detail-label">Prioridade:</span> ${school.priority === 'high' ? 'üî¥ Alta' : school.priority === 'medium' ? 'üü° M√©dia' : 'üü¢ Baixa'}
            </div>
            <div class="distance ${distanceClass}">
              üìç ${school.distance} km at√© a diretoria
            </div>
            <div class="vehicle-info ${vehicles.total > 0 ? 'has-vehicles' : 'no-vehicles'}">
              üöó ${vehicles.total} ve√≠culos na diretoria
            </div>
          </div>
        `;

        schoolItem.onclick = () => {
          map.setView([school.lat, school.lng], 12);
          showConnection(school.lat, school.lng, school.de_lat, school.de_lng);
        };

        container.appendChild(schoolItem);
      });
    }

    // Criar gr√°ficos
    function createCharts() {
      // Preparar dados por diretoria
      const diretoriaStats = {};
      schoolsData.forEach(school => {
        if (!diretoriaStats[school.diretoria]) {
          diretoriaStats[school.diretoria] = {
            schools: 0,
            highPriority: 0,
            vehicles: vehicleData[school.diretoria.toUpperCase()]?.total || 0
          };
        }
        diretoriaStats[school.diretoria].schools++;
        if (school.priority === 'high') {
          diretoriaStats[school.diretoria].highPriority++;
        }
      });

      // Gr√°fico de ve√≠culos vs demanda
      const ctx1 = document.getElementById('vehicleChart').getContext('2d');
      const labels = Object.keys(diretoriaStats);
      const vehiclesData = labels.map(d => diretoriaStats[d].vehicles);
      const demandData = labels.map(d => diretoriaStats[d].highPriority);

      new Chart(ctx1, {
        type: 'bar',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'Ve√≠culos Dispon√≠veis',
              data: vehiclesData,
              backgroundColor: 'rgba(52, 152, 219, 0.8)',
              borderColor: 'rgba(52, 152, 219, 1)',
              borderWidth: 1
            },
            {
              label: 'Escolas Alta Prioridade',
              data: demandData,
              backgroundColor: 'rgba(231, 76, 60, 0.8)',
              borderColor: 'rgba(231, 76, 60, 1)',
              borderWidth: 1
            }
          ]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
            }
          },
          scales: {
            x: {
              ticks: {
                maxRotation: 45
              }
            },
            y: {
              beginAtZero: true
            }
          }
        }
      });

      // Gr√°fico de prioridades
      const ctx2 = document.getElementById('priorityChart').getContext('2d');
      const priorityCounts = {
        high: schoolsData.filter(s => s.priority === 'high').length,
        medium: schoolsData.filter(s => s.priority === 'medium').length,
        low: schoolsData.filter(s => s.priority === 'low').length
      };

      new Chart(ctx2, {
        type: 'doughnut',
        data: {
          labels: ['Alta Prioridade', 'M√©dia Prioridade', 'Baixa Prioridade'],
          datasets: [{
            data: [priorityCounts.high, priorityCounts.medium, priorityCounts.low],
            backgroundColor: [
              'rgba(231, 76, 60, 0.8)',
              'rgba(243, 156, 18, 0.8)',
              'rgba(39, 174, 96, 0.8)'
            ],
            borderColor: [
              'rgba(231, 76, 60, 1)',
              'rgba(243, 156, 18, 1)',
              'rgba(39, 174, 96, 1)'
            ],
            borderWidth: 2
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'bottom',
            }
          }
        }
      });
    }

    // Sistema de filtros
    let currentFilter = 'all';
    let currentSearch = '';

    function applyFilters() {
      let filtered = schoolsData;

      if (currentFilter !== 'all') {
        if (currentFilter.startsWith('priority-')) {
          const priority = currentFilter.split('-')[1];
          filtered = filtered.filter(school => school.priority === priority);
        } else {
          filtered = filtered.filter(school => school.type === currentFilter);
        }
      }

      if (currentSearch) {
        filtered = filtered.filter(school =>
          school.name.toLowerCase().includes(currentSearch.toLowerCase()) ||
          school.city.toLowerCase().includes(currentSearch.toLowerCase()) ||
          school.diretoria.toLowerCase().includes(currentSearch.toLowerCase())
        );
      }

      renderSchoolList(filtered);
      addSchoolMarkers(filtered);
    }

    // Event listeners
    document.querySelectorAll('.filter-btn').forEach(btn => {
      btn.addEventListener('click', (e) => {
        document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
        e.target.classList.add('active');
        currentFilter = e.target.dataset.filter;
        applyFilters();
      });
    });

    document.getElementById('search-input').addEventListener('input', (e) => {
      currentSearch = e.target.value;
      applyFilters();
    });

    // Inicializar
    calculateStats();
    addSchoolMarkers(schoolsData);
    addDiretoriaMarkers();
    renderSchoolList(schoolsData);
    createCharts();

    // Fun√ß√£o global
    window.showConnection = showConnection;
  </script>
</body>

</html>